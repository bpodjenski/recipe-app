<!-- views/recipe.ejs -->

<div class="d-flex justify-content-center mb-4">
    <div class="card" style="max-width: 350px; width: 100%;">
        <% if (recipe.Images && recipe.Images.length > 0) { %>
            <div id="recipeCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
              <div class="carousel-inner">
                <% recipe.Images.forEach((image, index) => { %>
                  <div class="carousel-item <%= index === 0 ? 'active' : '' %>" style="height: 400px; overflow: hidden;">
                    <img src="/uploads/<%= image.filename %>" class="d-block w-100" alt="Recipe Image" style="cursor: zoom-in;" data-bs-toggle="modal" data-bs-target="#imageModal" data-image="/uploads/<%= image.filename %>">
                  </div>
                <% }) %>
              </div>
          
              <% if (recipe.Images.length > 1) { %>
                <button class="carousel-control-prev" type="button" data-bs-target="#recipeCarousel" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#recipeCarousel" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              <% } %>
            </div>
          <% } else { %>
            <p>No images uploaded for this recipe.</p>
          <% } %>
    </div>
  </div>
<h1><%= recipe.name %></h1>
<p><strong>By:</strong> <%= recipe.person %></p>
<p><strong>Cook Time:</strong> <%= recipe.cookTime %></p>
<p><strong>Notes:</strong> <%= recipe.notes %></p>

<hr>

<h4>Ingredients</h4>
<ul>
  <% recipe.Ingredients.forEach(ing => { %>
    <li><%= ing.amount %> - <%= ing.name %></li>
  <% }) %>
</ul>

<hr>

<h4>Instructions</h4>
<p><%= recipe.instructions %></p>
<!-- onsubmit="return confirm('Are you sure?')" -->
<hr>

<form action="/recipe/<%= recipe.id %>/add-photo" method="POST" enctype="multipart/form-data">
    <input type="file" name="image" accept="image/*" required>
    <button type="submit">Upload</button>
</form>

<hr>

<form action="/recipe/delete/<%= recipe.id %>" method="POST">
    <button type="submit" class="btn btn-danger">Delete</button>
</form>

<hr>

<h4>Comments</h4>
<% if (recipe.Comments.length === 0) { %>
  <p>No comments yet. Be the first!</p>
<% } else { %>
  <% recipe.Comments.forEach(comment => { %>
    <div class="mb-3">
      <strong><%= comment.person %></strong> â€” <small><%= new Date(comment.date).toLocaleString() %></small>
      <p><%= comment.text %></p>
    </div>
  <% }) %>
<% } %>

<h5 class="mt-4">Add a Comment</h5>
<form method="POST" action="/recipe/<%= recipe.id %>/comments">
  <div class="mb-3">
    <label class="form-label">Your Name</label>
    <input type="text" name="person" class="form-control" required />
  </div>
  <div class="mb-3">
    <label class="form-label">Comment</label>
    <textarea name="text" class="form-control" rows="3" required></textarea>
  </div>
  <button class="btn btn-primary">Post Comment</button>
</form>

<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content bg-dark">
        <div class="modal-body text-center p-0">
            <img id="modalImage" src="" alt="Full View" class="img-fluid rounded">
        </div>
        </div>
    </div>
</div>

<script>
    const imageModal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
  
    imageModal.addEventListener('show.bs.modal', function (event) {
      const triggerImg = event.relatedTarget;
      const imageSrc = triggerImg.getAttribute('data-image');
      modalImage.src = imageSrc;
    });
</script>
